{"version":3,"file":"main.min.js","sources":["../../src/scripts/utils/get-offset.js","../../src/scripts/lib/star-plus-canvas.js","../../src/scripts/lib/audio-player.js","../../src/scripts/lib/recorder.js","../../src/scripts/lib/image-loader.js","../../src/scripts/main.js"],"sourcesContent":["export default function(evt) {\n\tlet el = evt.target;\n\tlet x = 0;\n\tlet y = 0;\n\n\twhile (el && !isNaN(el.offsetLeft) && !isNaN(el.offsetTop)) {\n\t\tx += el.offsetLeft - el.scrollLeft;\n\t\ty += el.offsetTop - el.scrollTop;\n\t\tel = el.offsetParent;\n\t}\n\n\tx = evt.clientX - x;\n\ty = evt.clientY - y;\n\n\treturn { x: x, y: y };\n}","/* globals FaceDetector */\nimport getOffset from '../utils/get-offset';\n\nclass StarPlusCanvas {\n\n\tconstructor (el) {\n\t\tthis.canvas = el;\n\t\tthis.ctx = this.canvas.getContext('2d');\n\t\tthis.img = null;\n\t}\n\n\tinit(img) {\n\t\tthis.focalPoints = [];\n\t\tthis.isPlaying = false;\n\t\tthis.canvas.width = Math.min(window.innerWidth, 600);\n\t\tthis.canvas.height = this.canvas.width / img.width * img.height;\n \n\t\tthis.img = img;\n\t\timg.style.display = 'none';\n\n\t\tthis.canvas.addEventListener('click', this.addPoint.bind(this));\n\n\t\tthis.drawImage(img);\n\n\t\tthis.detectFaces();\n\t}\n\n\taddPoint(e) {\n\t\tthis.ctx.strokeText('x',e.layerX,e.layerY);\n\t\tthis.focalPoints.push(getOffset(e));\n\t}\n\n\tdrawImage() {\n\t\tthis.ctx.drawImage(this.img, 0, 0, this.img.width, this.img.height, 0, 0, this.canvas.width, this.canvas.height);\n\t}\n\n\tget stream() {\n\t\treturn typeof this.canvas.captureStream !== 'undefined' ? this.canvas.captureStream() : null;\n\t}\n\n\tpadFocalPoints() {\n\t\tif(this.focalPoints.length < 10) {\n\t\t\tfor(var i = this.focalPoints.length; i<10; i++) {\n\t\t\t\tthis.focalPoints.push({\n\t\t\t\t\tx: Math.random() * this.canvas.width,\n\t\t\t\t\ty: Math.random() * this.canvas.height\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn this.focalPoints;\n\t}\n\n\tstart() {\n\t\tthis.isPlaying = true;\n\t\tconst zConf = this.padFocalPoints().map((pt) => ({\n\t\t\tctx: this.ctx,\n\t\t\tstart: pt,\n\t\t\tmaxIterations: (Math.random() * 150) + 100,\n\t\t\tfactor: (Math.random() * 0.02) + 1.005\n\t\t}));\n\n\t\treturn this.zoom(zConf[0])\n\t\t\t.then(() => this.filter('brightness(10)', 100))\n\t\t\t.then(() => this.zoom(zConf[1]))\n\t\t\t.then(() => {\n\t\t\t\tthis.filter('hue-rotate(50deg)', 400);\n\t\t\t\treturn this.zoom(zConf[2]);\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.filter('hue-rotate(-50deg)', 400);\n\t\t\t\treturn this.zoom(zConf[3]);\n\t\t\t})\n\t\t\t.then(() => this.zoom(zConf[4]))\n\t\t\t.then(() => {\n\t\t\t\tthis.filter('invert(100%)', 300);\n\t\t\t\treturn this.zoom(zConf[5]);\n\t\t\t})\n\t\t\t.then(() => this.zoom(zConf[6]))\n\t\t\t.then(() => {\n\t\t\t\tthis.filter('brightness(1.2)', 400);\n\t\t\t\treturn this.zoom(zConf[7]);\n\t\t\t})\n\t\t\t.then(() => this.filter('invert(100%);blur(2px)', 2000))\n\t\t\t.then(() => this.zoom(zConf[8]))\n\t\t\t.then(() => {\n\t\t\t\tthis.filter('hue-rotate(120deg)', 400);\n\t\t\t\treturn this.zoom(zConf[9]);\n\t\t\t});\n\t}\n\n\tstop() {\n\t\tthis.isPlaying = false;\n\t\tthis.ctx.restore();\n\t}\n\n\tzoom (opts, iterations) {\n\t\tthis.ctx.save();\n\t\titerations = iterations || 0;\n\t\tvar doZoom = () => {\n\t\t\tif(!this.isPlaying) return;\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tthis.ctx.translate(opts.start.x,opts.start.y);\n\t\t\t\tif(iterations++ < opts.maxIterations / 2) {\n\t\t\t\t\tthis.ctx.scale(opts.factor, opts.factor);\n\t\t\t\t} else if (iterations < opts.maxIterations) {\n\t\t\t\t\tthis.ctx.scale(1/opts.factor,1/opts.factor);\n\t\t\t\t} else {\n\t\t\t\t\tthis.ctx.restore();\n\t\t\t\t\treturn resolve('asda');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.ctx.translate(-opts.start.x,-opts.start.y);\n\t\t\t\tthis.drawImage();\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tresolve(doZoom(opts, iterations));\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\n\t\treturn Promise.resolve(doZoom());\n\t\t\n\t}\n\n\tdetectFaces() {\n\t\tif (window.FaceDetector == undefined) {\n\t\t\tconsole.error('Face Detection not supported');\n\t\t\treturn;\n\t\t}\n\n\t\tconst faceDetector = new FaceDetector();\n\t\tconst scale = this.canvas.width / this.img.width;\n\t\tfaceDetector.detect(this.img)\n\t\t\t.then(faces => {\n\t\t\t// Draw the faces on the <canvas>.\n\t\t\t\tthis.ctx.lineWidth = 2;\n\t\t\t\tthis.ctx.strokeStyle = 'red';\n\t\t\t\tfor(let face of faces) {\n\t\t\t\t\tconst box = face.boundingBox;\n\t\t\t\t\tthis.ctx.rect(Math.floor(box.x * scale),\n\t\t\t\t\t\tMath.floor(box.y * scale),\n\t\t\t\t\t\tMath.floor(box.width * scale),\n\t\t\t\t\t\tMath.floor(box.height * scale));\n\t\t\t\t\tthis.ctx.stroke();\n\t\t\t\t\tthis.focalPoints.push({\n\t\t\t\t\t\tx: box.x * scale,\n\t\t\t\t\t\ty: box.y * scale\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t.catch((e) => {\n\t\t\tconsole.error('Boo, Face Detection failed: ' + e);\n\t\t});\n\t}\n\n\tfilter(effect, duration) {\n\t\tif(!this.isPlaying) return;\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.ctx.filter = effect;\n\t\t\tthis.drawImage();\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.ctx.filter = 'none';\n\t\t\t\tthis.drawImage();\n\t\t\t\treturn resolve();\n\t\t\t}, duration);\n\t\t});\n\t}\n}\n\n\n\n\nexport default StarPlusCanvas;","\nclass AudioPlayer {\n\n\tconstructor() {\n\t\tthis.audio = new Audio();\n\t\tthis.audio.src = 'dramatic.mp3';\n\t\tif(typeof AudioContext === 'function') {\n\n\t\t\tthis.ctx = new AudioContext();\n\t\t\tthis.audio.oncanplay = this.setUpStream.bind(this);\n\t\t}\n\t\tthis.stream = null;\n\t}\n\n\tsetUpStream() {\n\t\t// create a stream from our AudioContext\n\t\tconst dest = this.ctx.createMediaStreamDestination();\n\t\tthis.stream = dest.stream;\n\t\t// connect our audio element's output to the stream\n\t\tconst sourceNode = this.ctx.createMediaElementSource(this.audio);\n\t\tsourceNode.connect(this.ctx.destination);\n\t\tsourceNode.connect(dest);\n\n\t\tthis.audio.oncanplay = null;\n\n\t}\n\n\tget track() {\n\t\treturn this.stream.getAudioTracks()[0];\n\t}\n\n\tstart() {\n\t\tthis.audio.play();\n\t}\n\n\tstop() {\n\t\tthis.audio.pause();\n\t\tthis.audio.currentTime = 0;\n\t}\n}\n\nexport default AudioPlayer;","/*globals MediaRecorder */\nclass Recorder {\n\n\tconstructor(stream, audioPlayer) {\n\t\tthis.stream = stream;\n\t\tthis.mediaSource = new MediaSource();\n\t\tthis.mediaRecorder = null;\n\t\tthis.recordedBlobs = [];\n\t\tthis.sourceBuffer = null;\n\t\tthis.audioPlayer = audioPlayer;\n\t}\n\n\tstart() {\n\t\t//reset the recorded blobs\n\t\tthis.recordedBlobs = [];\n\t\tif(this.stream && this.stream.addTrack) {\n\t\t\tthis.stream.addTrack(this.audioPlayer.track);\n\t\t}\n\n\n\t\ttry {\n\t\t\tvar mixedStream = 'MediaStream' in window ? \n\t\t\tnew MediaStream([this.stream.getVideoTracks()[0], this.audioPlayer.track]) :\n\t\t\tthis.stream;\n\t\t\tthis.mediaRecorder = new MediaRecorder(mixedStream);\n\t\t} catch (e) {\t\t\n\t\t\tconsole.log('MediaRecorder is not supported by this browser', e);\n\t\t\treturn;\n\t\t}\n\n\t\t//store the data whenever the mediarecorder gives us something\n\t\tconst handleDataAvailable = (event) => {\n\t\t\tif (event.data && event.data.size > 0) {\n\t\t\t\tthis.recordedBlobs.push(event.data);\n\t\t\t}\n\t\t};\n\n\t\tthis.mediaRecorder.ondataavailable = handleDataAvailable;\n\n\t\t//start recording\n\t\tthis.mediaRecorder.start(100);\n\t}\n\n\tstop() {\n\t\tif(this.mediaRecorder && this.mediaRecorder.state === 'recording') {\n\t\t\tthis.mediaRecorder.stop();\n\t\t}\n\t}\n\n\tdownload() {\n\t\tconst blob = new Blob(this.recordedBlobs);\n\t\tconst url = window.URL.createObjectURL(blob);\n\t\tconst a = document.createElement('a');\n\t\ta.style.display = 'none';\n\t\ta.href = url;\n\t\ta.download = 'star-plus.webm';\n\t\tdocument.body.appendChild(a);\n\t\ta.click();\n\t\tsetTimeout(function() {\n\t\t\tdocument.body.removeChild(a);\n\t\t\twindow.URL.revokeObjectURL(url);\n\t\t}, 100);\n\t}\n\n}\n\nexport default Recorder;","export default function(el, onLoadFn) {\n\tconst img = new Image();\n\n\tel.addEventListener('change', (e) => {\n\t\tconst reader = new FileReader();\n\t\treader.onload = function(event){\n\n\t\t\timg.onload = function(){\n\t\t\t\tonLoadFn(img);\n\t\t\t};\n\t\t\timg.src = event.target.result;\n\t\t};\n\t\treader.readAsDataURL(e.target.files[0]);   \n\t}, false);\n}","import StarPlusCanvas from './lib/star-plus-canvas';\nimport AudioPlayer from './lib/audio-player';\nimport Recorder from './lib/recorder';\nimport imageLoader from './lib/image-loader';\n\nconst init = () => {\n\n\tconst canvasEl = document.getElementById('c');\n\tconst imageLoaderEl =  document.getElementById('imageLoader');\n\tconst startBtn = document.getElementById('start');\n\tconst stopBtn = document.getElementById('stop');\n\tconst downloadBtn = document.getElementById('download');\n\n\tconst spCanvas = new StarPlusCanvas(canvasEl);\n\tconst audioPlayer = new AudioPlayer();\n\tconst recorder = new Recorder(spCanvas.stream, audioPlayer);\n\n\timageLoader(imageLoaderEl, spCanvas.init.bind(spCanvas));\n\n\tconst stop = () => {\n\t\tspCanvas.stop();\n\t\taudioPlayer.stop();\n\t\trecorder.stop();\n\t\tdownloadBtn.classList.add('show');\n\t};\n\t\n\tstartBtn.addEventListener('click', () => {\n\t\tspCanvas.start().then(stop);\n\t\taudioPlayer.start();\n\t\trecorder.start();\n\t\tdownloadBtn.classList.remove('show');\n\t});\n\n\n\tstopBtn.addEventListener('click', stop);\n\n\tdownloadBtn.addEventListener('click', () => {\n\t\trecorder.download();\n\t});\n};\n\n\nconst registerWorker = () => {\n\tif ('serviceWorker' in navigator) {\n\t\tnavigator.serviceWorker\n\t\t\t.register('/star-plus/worker.js', { scope: '/star-plus/'});\n\t}\n};\n\ninit();\nregisterWorker();"],"names":["evt","el","target","x","y","isNaN","offsetLeft","offsetTop","scrollLeft","scrollTop","offsetParent","clientX","clientY","StarPlusCanvas","canvas","ctx","getContext","img","focalPoints","isPlaying","width","Math","min","window","innerWidth","height","style","display","addEventListener","addPoint","bind","drawImage","detectFaces","e","strokeText","layerX","layerY","push","getOffset","length","i","random","zConf","padFocalPoints","map","pt","zoom","then","filter","restore","opts","iterations","save","doZoom","Promise","resolve","translate","start","maxIterations","scale","factor","FaceDetector","undefined","error","faceDetector","detect","lineWidth","strokeStyle","faces","face","box","boundingBox","rect","floor","stroke","catch","effect","duration","captureStream","AudioPlayer","audio","Audio","src","AudioContext","oncanplay","setUpStream","stream","dest","createMediaStreamDestination","sourceNode","createMediaElementSource","connect","destination","play","pause","currentTime","getAudioTracks","Recorder","audioPlayer","mediaSource","MediaSource","mediaRecorder","recordedBlobs","sourceBuffer","addTrack","track","mixedStream","MediaStream","getVideoTracks","MediaRecorder","log","handleDataAvailable","event","data","size","ondataavailable","state","stop","blob","Blob","url","URL","createObjectURL","a","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","onLoadFn","Image","reader","FileReader","onload","result","readAsDataURL","files","init","canvasEl","getElementById","imageLoaderEl","startBtn","stopBtn","downloadBtn","spCanvas","recorder","classList","add","remove","registerWorker","navigator","serviceWorker","register","scope"],"mappings":"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"}